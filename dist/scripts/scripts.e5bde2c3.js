"use strict";function AuthFactory(a,b,c){function d(){return a.get("http://localhost:3000/refresh-navbar").success(function(a){angular.copy(a.user,e)})}var e={},f=function(d){return a.post("http://localhost:3000/login",d).success(function(d){angular.copy(d.user,e),c.localStorage.setItem("gl-user-token",d.user.token),a.defaults.headers.common.Authorization="Token token="+d.user.token,b.path("")})},g=function(){c.localStorage.removeItem("gl-user-token"),b.path("/login")},h=function(){var a=c.localStorage.getItem("gl-user-token");return a?!0:!1};return{login:f,logOut:g,getProfile:d,currentUser:e,isLoggedIn:h}}function UserFactory(a,b,c,d){function e(a){angular.copy(a,s)}function f(b){return a.get("http://localhost:3000/users/"+b).then(function(a){angular.copy(a.data.user,s)})}function g(a){r.splice(h(a.id),1)}function h(a){for(var b=0;b<r.length;b++)if(r[b].id===a)return b}function i(){var c=b.localStorage.getItem("gl-user-id");return a.get("http://localhost:3000/users/"+c).then(function(a){angular.copy(a.data,s)})}function j(b){return a.get("http://localhost:3000/users?username="+b).then(function(a){angular.copy(a.data.users,r)})}function k(){return a.get("http://localhost:3000/followers").then(function(a){angular.copy(a.data.users,r)})}function l(){return a.get("http://localhost:3000/following").then(function(a){angular.copy(a.data.users,r)})}function m(b){return a.get("http://localhost:3000/users/"+b+"/follow").then(function(a){angular.copy(a.data.user,s),r.length>0&&(r[h(b)]=a.data.user)})}function n(b){return a.get("http://localhost:3000/users/"+b+"/unfollow").then(function(a){angular.copy(a.data.user,s),r.length>0&&(r[h(b)]=a.data.user)})}function o(e){var f={auth:e};if(e.id)return a.put("http://localhost:3000/users"+e.id,f).success(j);var g=e.avatar;return d.upload({url:"http://localhost:3000/register",method:"POST",fields:{"auth[username]":e.username,"auth[email]":e.email,"auth[password]":e.password,"auth[bio]":e.bio},file:g,fileFormDataName:"auth[avatar]"}).success(function(d){b.localStorage.setItem("gl-user-token",d.user.token),a.defaults.headers.common.Authorization="Token token="+d.user.token,c.path("/")})}function p(b){return a["delete"]("http://localhost:3000/users/"+b.id)}var q,r=[],s={};return{search:q,users:r,user:s,removeUser:g,getUser:f,setUser:e,getProfile:i,getFollowing:l,getFollowers:k,getUsers:j,deleteUser:p,followUser:m,unfollowUser:n,upsertUser:o}}function PictureFactory(a,b,c,d){function e(a){angular.copy(a,k)}function f(b){return a.get("http://localhost:3000").then(function(a){angular.copy(a.data.pictures,l)})}function g(b){return a.get("http://localhost:3000/pictures/"+b).then(function(a){angular.copy(a.data.picture,k)})}function h(b){return a.get("http://localhost:3000/pictures").then(function(a){angular.copy(a.data.pictures,l)})}function i(b){return a["delete"]("http://localhost:3000/pictures/"+b).then(function(a){d.path("/new-picture")})}function j(a){var c=a.image;return a.filter="",a.filters&&$.each(a.filters,function(b,c){a.filter+=c}),$.each(a.sliderFilters,function(b,c){if(c>0)switch(b){case"paint":a.filter+="-paint ",a.filter+=c,a.filter+=" ";break;case"swirl":a.filter+="-swirl ",a.filter+=c,a.filter+=" ";break;case"implode":a.filter+="-implode ",a.filter+=c,a.filter+=" ";break;case"posterize":a.filter+="-posterize ",a.filter+=c,a.filter+=" ";break;case"powerleak":a.filter+="-morphology Thicken:",a.filter+=c,a.filter+=' "3x1+2+0: 1 0 0 " ';break;case"tapestry":a.filter+="-resize ",a.filter+=c,a.filter+="x",a.filter+=c,a.filter+=" -define distort:viewport=510x510 -virtual-pixel Mirror -distort SRT 0  +repage "}}),d.path("/glitch-in-progress"),b.upload({url:"http://localhost:3000/pictures",method:"POST",fields:{"picture[caption]":a.caption,"picture[filter]":a.filter},file:c,fileFormDataName:"picture[image]"}).then(function(a){d.path("/preview/"+a.data.picture.id)})}var k={};k.sliderFilters={},k.sliderFilters.paint=0,k.sliderFilters.swirl=0,k.sliderFilters.implode=0,k.sliderFilters.powerleak=0,k.sliderFilters.tapestry=0,k.sliderFilters.posterize=0,k.filters={};var l=[];return{picture:k,pictures:l,getFeed:f,deletePicture:i,setPicture:e,createPicture:j,getPictures:h,getPicture:g}}function AuthCtrl(a,b){var c=this;c.credentials={},c.login=function(d){b.login(d).then(function(b){c.credentials={},a.path("")})},c.logout=function(){b.logout()},c.isLoggedIn=function(){return b.isLoggedIn()}}function NavbarCtrl(a,b,c){var d=this;d.searchString="",d.currentUser=c.currentUser,d.isLoggedIn=function(){return c.isLoggedIn()},d.logOut=function(){c.logOut()},d.searchUsers=function(c){b.getUsers(c).then(function(b){a.path("/users"),a.search("username",c),d.searchString=""})};var e=function(){!d.currentUser.username&&d.isLoggedIn&&c.getProfile()};e()}function UserCtrl(a,b,c){function d(){b.setUser({}),f.serverErrors=!1}function e(a){var b="";return angular.forEach(a,function(a,c){b+=c+": "+a}),b}var f=this,g=a.userId;f.users=b.users,f.user=b.user,f.search=b.search,f.upsertUser=function(a){b.upsertUser(a).then(function(){d()},function(a){f.serverErrors=!0,f.serverErrorMsg=e(a.data)})},f.showProfile=function(){b.getProfile()},f.followUser=function(a){b.followUser(a)},f.isCurrentUser=function(a){return c.currentUser.id===a?!0:!1},f.unfollowUser=function(a){b.unfollowUser(a)},f.showUser=function(){b.getUser(g)},f.searchUsers=function(){b.getUsers(search)},f.removeUser=function(a){b.removeUser(a)},f.cancel=function(){d()}}function PictureCtrl(a,b,c,d,e){function f(a,b){j.picture.comments.push(a);for(var c=0;c<j.pictures.length;c++)j.pictures[c].id===b&&j.pictures[c].comments.push(a)}function g(a,b){b?j.picture.likes--:j.picture.likes++,j.picture.liked_by_user=!j.picture.liked_by_user;for(var c=0;c<j.pictures.length;c++)j.pictures[c].id===a&&(j.pictures[c].liked_by_user=!j.pictures[c].liked_by_user)}function h(){c.setPicture({}),j.serverErrors=!1}function i(a){var b="";return angular.forEach(a,function(a,c){b+=c+": "+a}),b}var j=this,k=a.pictureId;j.picture=c.picture,j.pictures=c.pictures,j.comment=c.comment,j.createComment=function(b){d.createComment(j.comment,a.pictureId).then(function(a){f(a.data.comment,b),j.comment=""})},j.createPicture=function(a){c.createPicture(a).then(function(){h()},function(a){j.serverErrors=!0,j.serverErrorMsg=i(a.data)})},j.toggleLike=function(a,b){var c;c=b?!0:!1,(b?e.unlike(a):e.like(a)).then(function(b){g(a,c)})},j.deletePicture=function(){c.deletePicture(k)},j.showPictures=function(){c.getPictures()},j.showFeed=function(){c.getFeed()},j.showPicture=function(){c.getPicture(k)},j.cancel=function(){h()}}function glLoginForm(){return{restrict:"E",templateUrl:"views/login-form.html",controller:AuthCtrl,controllerAs:"AuthCtrl",bindToController:!0,scope:{credentials:"&"}}}function glSignUpForm(){return{restrict:"E",templateUrl:"views/sign-up-form.html",controller:UserCtrl,controllerAs:"UserCtrl",bindToController:!0}}function glPictureList(){return{restrict:"E",templateUrl:"views/picture-list.html",controller:PictureCtrl,controllerAs:"PictureCtrl",bindToController:!0,link:function(a,b){a.PictureCtrl.showFeed()}}}function glPictureShow(){return{restrict:"E",templateUrl:"views/picture-show.html",controller:PictureCtrl,controllerAs:"PictureCtrl",bindToController:!0,link:function(a,b,c){a.PictureCtrl.showPicture()}}}function glPictureGrid(){return{restrict:"E",templateUrl:"views/picture-grid.html",controller:PictureCtrl,controllerAs:"PictureCtrl",bindToController:!0,link:function(a){a.PictureCtrl.showPictures()}}}function glPictureForm(){return{restrict:"E",templateUrl:"views/picture-form.html",controller:PictureCtrl,controllerAs:"PictureCtrl",bindToController:!0}}function glNavBar(){return{restrict:"E",templateUrl:"views/navbar.html",controller:NavbarCtrl,controllerAs:"NavbarCtrl",bindToController:!0}}function glUserShow(){return{restrict:"E",templateUrl:"views/user-show.html",controller:UserCtrl,controllerAs:"UserCtrl",bindToController:!0,link:function(a){a.UserCtrl.showUser()}}}function glUserList(){return{restrict:"E",templateUrl:"views/user-list.html",controller:UserCtrl,controllerAs:"UserCtrl",bindToController:!0}}function glCloudPicture(a){return function(b,c){function d(a,b){return Math.floor(Math.random()*(b-a+1)+a)}function e(a){l=a.pageY,k=a.pageX,c.css({top:l+"px",left:k+"px"})}function f(){$(document).off("mousemove",e),$(document).off("mouseup",f)}var g=$(window).width(),h=$(window).height(),i=d(0,g),j=d(0,h),k=0,l=0;c.css({top:j,left:i,height:h/5+"px",width:h/5+"px"}),c.on("dblclick",function(d){b.$apply(function(){a.path("/pictures/"+c.data("id"))})}),c.on("mousedown",function(a){a.preventDefault(),$(document).on("mousemove",e),$(document).on("mouseup",f)})}}function glPreview(){return{restrict:"A",link:function(a,b){a.PictureCtrl.showPicture()}}}function init(){for(HEIGHT=window.innerHeight,WIDTH=window.innerWidth,windowHalfX=WIDTH/2,windowHalfY=HEIGHT/2,fieldOfView=75,aspectRatio=windowHalfX/windowHalfY,nearPlane=1,farPlane=5e3,cameraZ=farPlane/3,fogHex=0,fogDensity=1e-8,camera=new THREE.PerspectiveCamera(fieldOfView,aspectRatio,nearPlane,farPlane),camera.position.z=cameraZ,scene=new THREE.Scene,scene.fog=new THREE.FogExp2(fogHex,fogDensity),container=document.createElement("div"),container.setAttribute("id","background"),document.body.appendChild(container),geometry=new THREE.Geometry,particleCount=1e3,i=0;particleCount>i;i++){var a=new THREE.Vector3;a.x=4e3*Math.random()-2e3,a.y=4e3*Math.random()-2e3,a.z=4e3*Math.random()-2e3,geometry.vertices.push(a)}for(parameters=[[16737792,25],[414463,20],[16737792,15],[414463,10],[16737792,5]],parameterCount=parameters.length,i=0;parameterCount>i;i++)size=parameters[i][1],materials[i]=new THREE.PointCloudMaterial({size:size}),particles=new THREE.PointCloud(geometry,materials[i]),particles.rotation.x=6*Math.random(),particles.rotation.y=6*Math.random(),particles.rotation.z=6*Math.random(),scene.add(particles);renderer=new THREE.WebGLRenderer,renderer.setPixelRatio(window.devicePixelRatio),renderer.setSize(WIDTH,HEIGHT),container.appendChild(renderer.domElement),window.addEventListener("resize",onWindowResize,!1)}function animate(){requestAnimationFrame(animate),render()}function render(){var a=5e-5*Date.now();for(camera.position.x+=.05*(mouseX-camera.position.x),camera.position.y+=.05*(-mouseY-camera.position.y),camera.lookAt(scene.position),i=0;i<scene.children.length;i++){var b=scene.children[i];b instanceof THREE.PointCloud&&(b.rotation.y=a*(4>i?i+3:-(i+3)))}for(i=0;i<materials.length;i++)color=parameters[i][0],materials[i].color.setHex(color);renderer.render(scene,camera)}function onWindowResize(){windowHalfX=window.innerWidth/2,windowHalfY=window.innerHeight/2,camera.aspect=window.innerWidth/window.innerHeight,camera.updateProjectionMatrix(),renderer.setSize(window.innerWidth,window.innerHeight)}angular.module("frontendApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","angularFileUpload","ngTouch","MainController","MainDirective"]).run(["$rootScope","$http","$window","$location","$routeParams","AuthFactory","UserFactory","PictureFactory",function(a,b,c,d,e,f,g,h){if(f.isLoggedIn()){var i=c.localStorage.getItem("gl-user-token");b.defaults.headers.common.Authorization="Token token="+i}a.$on("$routeChangeStart",function(){"/users"===d.path()?g.getUsers(d.search().username):"/followers"===d.path()?g.getFollowers():"/following"===d.path()&&g.getFollowing()})}]),angular.module("frontendApp").config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html"}).when("/login",{templateUrl:"views/login-page.html"}).when("/followers",{templateUrl:"views/user-list-view.html"}).when("/following",{templateUrl:"views/user-list-view.html"}).when("/sign-up",{templateUrl:"views/sign-up-view.html"}).when("/pictures/:pictureId",{templateUrl:"views/picture-show-view.html"}).when("/discover",{templateUrl:"views/discover-view.html"}).when("/glitch-a-pic",{templateUrl:"views/new-picture-view.html"}).when("/users",{templateUrl:"views/user-list-view.html"}).when("/users/:userId",{templateUrl:"views/user-show-view.html"}).when("/glitch-in-progress",{templateUrl:"views/glitch-in-progress-view.html"}).when("/preview/:pictureId",{templateUrl:"views/preview-view.html",controller:PictureCtrl,controllerAs:"PictureCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("frontendApp").factory("AuthFactory",AuthFactory),AuthFactory.$inject=["$http","$location","$window"],angular.module("frontendApp").factory("UserFactory",UserFactory),UserFactory.$inject=["$http","$window","$location","$upload"],function(){function a(a){var b={},c=[],d=function(b,c){var d={comment:{body:b}};return a.post("http://localhost:3000/pictures/"+c+"/comments",d).success(function(a){angular.copy(a.comment,d)})};return{comment:b,comments:c,createComment:d}}angular.module("frontendApp").factory("CommentFactory",a),a.$inject=["$http"]}(),angular.module("frontendApp").factory("PictureFactory",PictureFactory),PictureFactory.$inject=["$http","$upload","$window","$location"],function(){function a(a){var b=function(b){var c={like:{}};return a.post("http://localhost:3000/pictures/"+b+"/likes",c).success(function(a){angular.copy(a.like,c)})},c=function(c){return a["delete"]("http://localhost:3000/pictures/"+c+"/likes").success(function(a){angular.copy({},b)})};return{like:b,unlike:c}}angular.module("frontendApp").factory("LikeFactory",a),a.$inject=["$http"]}(),angular.module("MainController",[]),angular.module("MainController").controller("AuthCtrl",AuthCtrl),AuthCtrl.$inject=["$location","AuthFactory"],angular.module("MainController").controller("NavbarCtrl",NavbarCtrl),NavbarCtrl.$inject=["$location","UserFactory","AuthFactory"],angular.module("MainController").controller("UserCtrl",UserCtrl),UserCtrl.$inject=["$routeParams","UserFactory","AuthFactory"],angular.module("MainController").controller("PictureCtrl",PictureCtrl),PictureCtrl.$inject=["$routeParams","$location","PictureFactory","CommentFactory","LikeFactory"],angular.module("MainDirective",[]),angular.module("MainDirective").directive("glLoginForm",glLoginForm),angular.module("MainDirective").directive("glSignUpForm",glSignUpForm),angular.module("MainDirective").directive("glPictureList",glPictureList),angular.module("MainDirective").directive("glPictureShow",glPictureShow),angular.module("MainDirective").directive("glPictureGrid",glPictureGrid),angular.module("MainDirective").directive("glPictureForm",glPictureForm),angular.module("MainDirective").directive("glNavBar",glNavBar),angular.module("MainDirective").directive("glUserShow",glUserShow),angular.module("MainDirective").directive("glUserList",glUserList),angular.module("MainDirective").directive("glCloudPicture",glCloudPicture),glCloudPicture.$inject=["$location"],angular.module("MainDirective").directive("glPreview",glPreview);var scene,camera,renderer,container,HEIGHT,WIDTH,fieldOfView,aspectRatio,nearPlane,farPlane,stats,geometry,particleCount,i,h,color,size,materials=[],mouseX=0,mouseY=0,windowHalfX,windowHalfY,cameraZ,fogHex,fogDensity,parameters,parameterCount,particles,container;init(),animate();