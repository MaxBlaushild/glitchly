"use strict";function AuthFactory(a,b,c){function d(){return a.get("https://desolate-gorge-7593.herokuapp.com/refresh-navbar").success(function(a){angular.copy(a.user,e)})}var e={},f=function(d){return a.post("https://desolate-gorge-7593.herokuapp.com/login",d).success(function(d){angular.copy(d.user,e),c.localStorage.setItem("gl-user-token",d.user.token),a.defaults.headers.common.Authorization="Token token="+d.user.token,b.path("")})},g=function(){c.localStorage.removeItem("gl-user-token"),b.path("/login")},h=function(){var a=c.localStorage.getItem("gl-user-token");return a?!0:!1};return{login:f,logOut:g,getProfile:d,currentUser:e,isLoggedIn:h}}function UserFactory(a,b,c,d){function e(a){angular.copy(a,q)}function f(b){return a.get("https://desolate-gorge-7593.herokuapp.com/users/"+b).then(function(a){angular.copy(a.data.user,q)})}function g(a){p.splice(h(a.id),1)}function h(a){for(var b=0;b<p.length;b++)if(p[b].id===a)return b}function i(){var c=b.localStorage.getItem("gl-user-id");return a.get("https://desolate-gorge-7593.herokuapp.com/users/"+c).then(function(a){angular.copy(a.data,q)})}function j(b){return a.get("https://desolate-gorge-7593.herokuapp.com/users?username="+b).then(function(a){angular.copy(a.data.users,p)})}function k(b){return a.get("https://desolate-gorge-7593.herokuapp.com/users/"+b+"/follow").then(function(a){angular.copy(a.data.user,q),p.length>0&&(p[h(b)]=a.data.user)})}function l(b){return a.get("https://desolate-gorge-7593.herokuapp.com/users/"+b+"/unfollow").then(function(a){angular.copy(a.data.user,q),p.length>0&&(p[h(b)]=a.data.user)})}function m(e){var f={auth:e};if(e.id)return a.put("https://desolate-gorge-7593.herokuapp.com/users"+e.id,f).success(j);var g=e.avatar;return d.upload({url:"https://desolate-gorge-7593.herokuapp.com/register",method:"POST",fields:{"auth[username]":e.username,"auth[email]":e.email,"auth[password]":e.password,"auth[bio]":e.bio},file:g,fileFormDataName:"auth[avatar]"}).success(function(d){b.localStorage.setItem("gl-user-token",d.user.token),a.defaults.headers.common.Authorization="Token token="+d.user.token,c.path("/")})}function n(b){return a["delete"]("https://desolate-gorge-7593.herokuapp.com/users/"+b.id)}var o,p=[],q={};return{search:o,users:p,user:q,removeUser:g,getUser:f,setUser:e,getProfile:i,getUsers:j,deleteUser:n,followUser:k,unfollowUser:l,upsertUser:m}}function PictureFactory(a,b,c,d){function e(a){angular.copy(a,j)}function f(b){return a.get("https://desolate-gorge-7593.herokuapp.com").then(function(a){angular.copy(a.data.pictures,k)})}function g(b){return a.get("https://desolate-gorge-7593.herokuapp.com/pictures/"+b).then(function(a){angular.copy(a.data.picture,j)})}function h(b){return a.get("https://desolate-gorge-7593.herokuapp.com/pictures").then(function(a){angular.copy(a.data.pictures,k)})}function i(a){var c=a.image;return b.upload({url:"https://desolate-gorge-7593.herokuapp.com/pictures",method:"POST",fields:{"picture[caption]":a.caption},file:c,fileFormDataName:"picture[image]"}).then(function(a){d.path("/pictures"),d.hash(a.data.picture.id)})}var j={},k=[];return{picture:j,pictures:k,getFeed:f,setPicture:e,createPicture:i,getPictures:h,getPicture:g}}function AuthCtrl(a,b){var c=this;c.credentials={},c.login=function(d){b.login(d).then(function(b){c.credentials={},a.path("")})},c.logout=function(){b.logout()},c.isLoggedIn=function(){return b.isLoggedIn()}}function NavbarCtrl(a,b,c){var d=this;d.searchString="",d.currentUser=c.currentUser,d.isLoggedIn=function(){return c.isLoggedIn()},d.logOut=function(){c.logOut()},d.searchUsers=function(c){b.getUsers(c).then(function(b){a.path("/users"),a.search("username",c),d.searchString=""})};var e=function(){!d.currentUser.username&&d.isLoggedIn&&c.getProfile()};e()}function UserCtrl(a,b,c){function d(){b.setUser({}),f.serverErrors=!1}function e(a){var b="";return angular.forEach(a,function(a,c){b+=c+": "+a}),b}var f=this,g=a.userId;f.users=b.users,f.user=b.user,f.search=b.search,f.upsertUser=function(a){b.upsertUser(a).then(function(){d()},function(a){f.serverErrors=!0,f.serverErrorMsg=e(a.data)})},f.showProfile=function(){b.getProfile()},f.followUser=function(a){b.followUser(a)},f.isCurrentUser=function(a){return c.currentUser.id===a?!0:!1},f.unfollowUser=function(a){b.unfollowUser(a)},f.showUser=function(){b.getUser(g)},f.searchUsers=function(){b.getUsers(search)},f.removeUser=function(a){b.removeUser(a)},f.cancel=function(){d()}}function PictureCtrl(a,b,c){function d(){c.setPicture({}),f.serverErrors=!1}function e(a){var b="";return angular.forEach(a,function(a,c){b+=c+": "+a}),b}var f=this,g=a.pictureId;f.picture=c.picture,f.pictures=c.pictures,f.createPicture=function(a){c.createPicture(a).then(function(){d()},function(a){f.serverErrors=!0,f.serverErrorMsg=e(a.data)})},f.showPictures=function(){c.getPictures()},f.showFeed=function(){c.getFeed()},f.showPicture=function(){c.getPicture(g)},f.cancel=function(){d()}}function glLoginForm(){return{restrict:"E",templateUrl:"views/login-form.html",controller:AuthCtrl,controllerAs:"AuthCtrl",bindToController:!0,scope:{credentials:"&"}}}function glSignUpForm(){return{restrict:"E",templateUrl:"views/sign-up-form.html",controller:UserCtrl,controllerAs:"UserCtrl",bindToController:!0}}function glPictureList(){return{restrict:"E",templateUrl:"views/picture-list.html",controller:PictureCtrl,controllerAs:"PictureCtrl",bindToController:!0,link:function(a,b){a.PictureCtrl.showFeed()}}}function glPictureShow(){return{restrict:"E",templateUrl:"views/picture-show.html",controller:PictureCtrl,controllerAs:"PictureCtrl",bindToController:!0,link:function(a,b,c){a.PictureCtrl.showPicture()}}}function glPictureGrid(){return{restrict:"E",templateUrl:"views/picture-grid.html",controller:PictureCtrl,controllerAs:"PictureCtrl",bindToController:!0,link:function(a){a.PictureCtrl.showPictures()}}}function glPictureForm(){return{restrict:"E",templateUrl:"views/picture-form.html",controller:PictureCtrl,controllerAs:"PictureCtrl",bindToController:!0}}function glNavBar(){return{restrict:"E",templateUrl:"views/navbar.html",controller:NavbarCtrl,controllerAs:"NavbarCtrl",bindToController:!0}}function glUserShow(){return{restrict:"E",templateUrl:"views/user-show.html",controller:UserCtrl,controllerAs:"UserCtrl",bindToController:!0,link:function(a){a.UserCtrl.showUser()}}}function glUserList(){return{restrict:"E",templateUrl:"views/user-list.html",controller:UserCtrl,controllerAs:"UserCtrl",bindToController:!0}}function glCloudPicture(a){return function(b,c){function d(a){i=a.pageY,h=a.pageX,c.css({top:i+"px",left:h+"px"})}function e(){$(document).off("mousemove",d),$(document).off("mouseup",e)}var f=getRandomInt(100,1400),g=getRandomInt(100,600),h=0,i=0;c.css({top:g,left:f}),c.on("dblclick",function(d){b.$apply(function(){a.path("/pictures/"+c.data("id"))})}),c.on("mousedown",function(a){a.preventDefault(),$(document).on("mousemove",d),$(document).on("mouseup",e)})}}function init(){for(HEIGHT=window.innerHeight,WIDTH=window.innerWidth,windowHalfX=WIDTH/2,windowHalfY=HEIGHT/2,fieldOfView=75,aspectRatio=windowHalfX/windowHalfY,nearPlane=1,farPlane=5e3,cameraZ=farPlane/3,fogHex=0,fogDensity=1e-8,camera=new THREE.PerspectiveCamera(fieldOfView,aspectRatio,nearPlane,farPlane),camera.position.z=cameraZ,scene=new THREE.Scene,scene.fog=new THREE.FogExp2(fogHex,fogDensity),container=document.createElement("div"),container.setAttribute("id","background"),document.body.appendChild(container),geometry=new THREE.Geometry,particleCount=1e3,i=0;particleCount>i;i++){var a=new THREE.Vector3;a.x=4e3*Math.random()-2e3,a.y=4e3*Math.random()-2e3,a.z=4e3*Math.random()-2e3,geometry.vertices.push(a)}for(parameters=[[16737792,25],[414463,20],[16737792,15],[414463,10],[16737792,5]],parameterCount=parameters.length,i=0;i<parameterCount;i++)size=parameters[i][1],materials[i]=new THREE.PointCloudMaterial({size:size}),particles=new THREE.PointCloud(geometry,materials[i]),particles.rotation.x=6*Math.random(),particles.rotation.y=6*Math.random(),particles.rotation.z=6*Math.random(),scene.add(particles);renderer=new THREE.WebGLRenderer,renderer.setPixelRatio(window.devicePixelRatio),renderer.setSize(WIDTH,HEIGHT),container.appendChild(renderer.domElement),window.addEventListener("resize",onWindowResize,!1)}function animate(){requestAnimationFrame(animate),render()}function render(){var a=5e-5*Date.now();for(camera.position.x+=.05*(mouseX-camera.position.x),camera.position.y+=.05*(-mouseY-camera.position.y),camera.lookAt(scene.position),i=0;i<scene.children.length;i++){var b=scene.children[i];b instanceof THREE.PointCloud&&(b.rotation.y=a*(4>i?i+3:-(i+3)))}for(i=0;i<materials.length;i++)color=parameters[i][0],materials[i].color.setHex(color);renderer.render(scene,camera)}function onWindowResize(){windowHalfX=window.innerWidth/2,windowHalfY=window.innerHeight/2,camera.aspect=window.innerWidth/window.innerHeight,camera.updateProjectionMatrix(),renderer.setSize(window.innerWidth,window.innerHeight)}function getRandomInt(a,b){return Math.floor(Math.random()*(b-a+1)+a)}angular.module("frontendApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","angularFileUpload","ngTouch","MainController","MainDirective"]).run(["$rootScope","$http","$window","$location","$routeParams","AuthFactory","UserFactory",function(a,b,c,d,e,f,g){if(f.isLoggedIn()){var h=c.localStorage.getItem("gl-user-token");b.defaults.headers.common.Authorization="Token token="+h}a.$on("$routeChangeStart",function(){"/users"===d.path()&&g.getUsers(d.search().username)})}]),angular.module("frontendApp").config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html"}).when("/login",{templateUrl:"views/login-page.html"}).when("/sign-up",{templateUrl:"views/sign-up-view.html"}).when("/pictures/:pictureId",{templateUrl:"views/picture-show-view.html"}).when("/discover",{templateUrl:"views/discover-view.html"}).when("/glitch-a-pic",{templateUrl:"views/new-picture-view.html"}).when("/users",{templateUrl:"views/user-list-view.html",reloadOnSearch:!1}).when("/users/:userId",{templateUrl:"views/user-show-view.html"}).otherwise({redirectTo:"/"})}]),angular.module("frontendApp").factory("AuthFactory",AuthFactory),AuthFactory.$inject=["$http","$location","$window"],angular.module("frontendApp").factory("UserFactory",UserFactory),UserFactory.$inject=["$http","$window","$location","$upload"],angular.module("frontendApp").factory("PictureFactory",PictureFactory),PictureFactory.$inject=["$http","$upload","$window","$location"],angular.module("MainController",[]),angular.module("MainController").controller("AuthCtrl",AuthCtrl),AuthCtrl.$inject=["$location","AuthFactory"],angular.module("MainController").controller("NavbarCtrl",NavbarCtrl),NavbarCtrl.$inject=["$location","UserFactory","AuthFactory"],angular.module("MainController").controller("UserCtrl",UserCtrl),UserCtrl.$inject=["$routeParams","UserFactory","AuthFactory"],angular.module("MainController").controller("PictureCtrl",PictureCtrl),PictureCtrl.$inject=["$routeParams","$location","PictureFactory"],angular.module("MainDirective",[]),angular.module("MainDirective").directive("glLoginForm",glLoginForm),angular.module("MainDirective").directive("glSignUpForm",glSignUpForm),angular.module("MainDirective").directive("glPictureList",glPictureList),angular.module("MainDirective").directive("glPictureShow",glPictureShow),angular.module("MainDirective").directive("glPictureGrid",glPictureGrid),angular.module("MainDirective").directive("glPictureForm",glPictureForm),angular.module("MainDirective").directive("glNavBar",glNavBar),angular.module("MainDirective").directive("glUserShow",glUserShow),angular.module("MainDirective").directive("glUserList",glUserList),angular.module("MainDirective").directive("glCloudPicture",glCloudPicture),glCloudPicture.$inject=["$location"];var scene,camera,renderer,container,HEIGHT,WIDTH,fieldOfView,aspectRatio,nearPlane,farPlane,stats,geometry,particleCount,i,h,color,size,materials=[],mouseX=0,mouseY=0,windowHalfX,windowHalfY;init(),animate();